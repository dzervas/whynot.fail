<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="Cause when you fail, somebody has to laugh at you"><title>Fusion 360 Internals: Trying to re-invent Fusion’s GUI (and failing) | WhyNot.Fail</title><!-- Fonts --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Raleway:wght@400;500;600;700&display=swap" rel="stylesheet"><!-- Favicon --><link rel="icon" type="image/svg+xml" href="/favicon.svg"><!-- RSS --><link rel="alternate" type="application/rss+xml" title="WhyNot.Fail RSS" href="/rss.xml"><style>.tag-list[data-astro-cid-lga65v7i]{display:flex;flex-wrap:wrap;gap:.5rem;list-style:none;padding:0;margin:0}.tag[data-astro-cid-lga65v7i]{display:inline-block;padding:.25rem .625rem;font-size:.8125rem;font-weight:500;text-decoration:none;color:var(--color-accent);background:var(--color-accent-bg);border:1px solid var(--color-accent-border);border-radius:4px;transition:all .15s ease}.tag[data-astro-cid-lga65v7i]:hover{background:var(--color-accent);color:var(--color-bg);border-color:var(--color-accent)}.build-badge[data-astro-cid-mzimu5gx]{display:inline-flex;align-items:center;font-family:JetBrains Mono,monospace;font-size:.8125rem;letter-spacing:.02em}.badge-prefix[data-astro-cid-mzimu5gx]{color:var(--color-text-muted)}.badge-status[data-astro-cid-mzimu5gx]{font-weight:600}.badge-passing[data-astro-cid-mzimu5gx] .badge-status[data-astro-cid-mzimu5gx]{color:var(--color-success)}.badge-failing[data-astro-cid-mzimu5gx] .badge-status[data-astro-cid-mzimu5gx]{color:var(--color-danger)}.badge-unknown[data-astro-cid-mzimu5gx] .badge-status[data-astro-cid-mzimu5gx]{color:var(--color-warning)}
</style>
<link rel="stylesheet" href="/_astro/_slug_.BSLznIs-.css">
<link rel="stylesheet" href="/_astro/_slug_.ClLXJwUM.css"></head> <body id="top"> <div class="site-wrapper"> <header class="site-header" data-astro-cid-3ef6ksr2> <div class="header-inner" data-astro-cid-3ef6ksr2> <a href="/" class="logo" aria-label="WhyNot.Fail" data-astro-cid-3ef6ksr2> <pre class="ascii-logo" aria-hidden="true" data-astro-cid-3ef6ksr2>
 █   █ █ █ █ █ █▄ █ █▀█ ▀█▀
 █▄█▄█ █▀█ ▀█▀ █ ▀█ █▄█  █
        ·FAIL·
      </pre> <span class="logo-tagline" data-astro-cid-3ef6ksr2>// cause_when_you_fail_somebody_has_to_laugh_at_you</span> </a> <div class="header-actions" data-astro-cid-3ef6ksr2> <nav class="nav-main" aria-label="Main navigation" data-astro-cid-3ef6ksr2> <ul class="nav-list" data-astro-cid-3ef6ksr2> <li data-astro-cid-3ef6ksr2> <a href="/" class="nav-link" data-astro-cid-3ef6ksr2> Home </a> </li><li data-astro-cid-3ef6ksr2> <a href="/about/" class="nav-link" data-astro-cid-3ef6ksr2> About </a> </li><li data-astro-cid-3ef6ksr2> <a href="/tags/" class="nav-link" data-astro-cid-3ef6ksr2> Tags </a> </li> </ul> </nav> <div class="search-shell" data-search-trigger data-astro-cid-3ef6ksr2> <input type="search" class="search-trigger" placeholder="Search" aria-label="Open search" readonly data-astro-cid-3ef6ksr2> <span class="search-shortcut" data-astro-cid-3ef6ksr2>Ctrl+K</span> </div> </div> </div> <div class="header-separator" aria-hidden="true" data-astro-cid-3ef6ksr2></div> </header>  <main class="main-content">  <article class="post" data-astro-cid-gjtny2mx> <header class="post-header" data-astro-cid-gjtny2mx> <div class="post-header-top" data-astro-cid-gjtny2mx> <a href="/" class="back-link" data-astro-cid-gjtny2mx> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-arrow-left "><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg> <span data-astro-cid-gjtny2mx>Back to posts</span> </a>  </div> <div class="post-meta" data-astro-cid-gjtny2mx> <time datetime="2023-03-25T00:00:00.000Z" data-astro-cid-gjtny2mx>25 March 2023</time> <span class="meta-sep" data-astro-cid-gjtny2mx>/</span> <span class="post-author" data-astro-cid-gjtny2mx>dzervas</span>  <span class="meta-sep" data-astro-cid-gjtny2mx>/</span> <span class="build-badge badge-failing" data-astro-cid-mzimu5gx> <span class="badge-prefix" data-astro-cid-mzimu5gx>build:</span> <span class="badge-status" data-astro-cid-mzimu5gx>[FAIL]</span> </span>   </div> <h1 class="post-title" data-astro-cid-gjtny2mx>Fusion 360 Internals: Trying to re-invent Fusion’s GUI (and failing)</h1> <div class="post-tags" data-astro-cid-gjtny2mx> <ul class="tag-list" data-astro-cid-lga65v7i><li data-astro-cid-lga65v7i><a href="/tags/reversing/" class="tag" data-astro-cid-lga65v7i>reversing</a></li><li data-astro-cid-lga65v7i><a href="/tags/windows/" class="tag" data-astro-cid-lga65v7i>windows</a></li></ul> </div> </header> <div class="post-hero" data-astro-cid-gjtny2mx> <img src="/images/notion-0c84cb3e-b45c-4163-aa77-3bc1a74f515b-DALLE_2023-03-25_18.11.05_-_add_a_small_door_under_the_logo_that_shows_entry_into_a_steampunk_coding_world.png" alt="Fusion 360 Internals: Trying to re-invent Fusion’s GUI (and failing)" loading="lazy" data-astro-cid-gjtny2mx> </div> <div class="post-content" data-astro-cid-gjtny2mx>  <p>This is one of those weird ones where I try to do something batshit crazy and I end up inevitably failing. It was almost too clear that this is gonna be the path but I needed something to hyperfocus on to have some stress-free moments.</p>
<p>This is how I tried to use only the engine/rendering canvas of Fusion and re-implement the whole GUI around it from scratch (toolbars, browser, history bar, etc.).</p>
<h1 id="wait-what-what-do-you-mean-why-what">Wait what? What do you mean? Why? What?</h1>
<p>Ok so let’s take it from the top. I love Fusion’s UX. It’s amazing. Everything is where it should be and stuff just work as you expect them. It does some weird fuckery when you try to direct model (organic handles, mouse shells, etc.) but it’s not the point of the software anyway. And almost nobody can rival it in my eyes. I’ve tried Solidworks, OnShape, BricsCAD, FreeCAD, Solid Edge, SolveSpace, Rhino 3D with Grasshoper. I’ve tried it all. I’ve seen it all. I’m dissapointed.</p>
<p>“Awesome, where’s the problem”, I can hear you say.</p>
<p>Linux. The problem is Linux. Running Fusion on Linux is… shitty. While <a href="https://github.com/cryinkfly/Autodesk-Fusion-360-for-Linux">cryinkfly has done an amazing work on the matter</a>, it’s not good enough for me. Crashes, glitches, overlayed artifacts across all workspaces and in general it makes the app quite cumbersome. It kills the UX.</p>
<p>So there were 3 solutions to that problem:</p>
<ul>
<li><del>Pivot to Windows</del> - nope, I prefer to leave computers behind</li>
<li>Windows VM - It sucks, it’s slow and it also sucks</li>
<li>Hook Fusion using frida to fix the artifacts/problems (and maybe give the solutions to Autodesk almost ready to implement) - too hard, too specific and too fragile. An update could render my whole work useless</li>
<li>Fix wine - it’s actually the best solution as it will benefit more apps. But I thought it would be harder (little did I know…)
Instead, I chose the 4th (5th?) option: Use the “hard parts” of Fusion by re-write the GUI as an open-source shell. Sure it would require “some” reversing but at some point I could have a Window with JUST the Canvas in it (where the 3D objects are drawn).</li>
</ul>
<p>Before I let you know my evil plan (according to Autodesk I imagine), let’s talk a bit about the guts of Fusion</p>
<h1 id="fusion-360s-gui-internals">Fusion 360’s GUI internals</h1>
<p>Fusion is written completely in Qt 5, start to finish. At the time of writing (25 March 2023) it uses Qt 5.15.2, the upstream LTS version.</p>
<p>They use MANY of Qt’s features and every component is written in a different “Qt manner”. Is the whole app a Qt demonstration? I guess we’ll never know…</p>
<ul>
<li>The whole window is a <code>QGuiApplication</code> window</li>
<li>The top toolbar and the botton design history bar are regular <code>QWidgets</code>, buttons, labels, icons, tooltips and the rest</li>
<li>All the sidepanels and overlays (Learning Center, Data Panel, Browser, Comments and Notification Center) are all HTML/CSS/JS that run inside different <code>QtWebEngine</code>s with a custom <a href="https://github.com/chromiumembedded">CEF</a> that gives access to the JS→C++ bridge. That bridge is called <code>FermontJS</code> and talks with the <code>Neuron</code> engine BTW</li>
<li>I have no idea where, but QtQuick is involved somwhere</li>
<li>The main “viewport” or <code>Shell</code> as Autodesk calls it (the main gray window that 3D stuff appear) is something… weird. Something very weird. It’s a class inside the <code>NuBase10.dll</code> that is called <code>Nu::GraphicsCanvas</code>
The last bit is what we’re looking for. The <code>QtWidgets</code> parts can be re-written. The toolbar is dynamically generated based on some XMLs, the design history is by definition programmatically populated, HTML/CSS/JS components are just in the installation folder for anyone to grab, <code>FermontJS</code> is just a node script and <code>Neuron</code> can be run in its own process (I think???).</li>
</ul>
<p>Not easy to do all that but certaintly doable.The hard part would be that damned <code>GraphicsCanvas</code>. It has many other names, <code>Canvas</code>, <code>QtCanvas</code> (sub/super classes) but its the same damned thing. If I could make an instance of it on its own window it would prove that I can actually run the part of Fusion that handles the CAD engine and renders what the user sees.</p>
<h1 id="how-would-that-help-you-with-wine">How would that help you with wine?</h1>
<p>The plan for the “final form” of the project was:</p>
<ol>
<li>Wrap the required DLLs using winelib</li>
<li>Dynamically link against them a Rust binary that:</li>
<li>Cross-compile that binary for every platform</li>
<li>Create an installer that pulls the required DLLs so that Autodesk won’t cry us a river for “redistribution”
Not an easy project but kiiiiiinda, maaaaaybe doable.</li>
</ol>
<h1 id="so-whats-the-problems">So what’s the problem(s)?</h1>
<p>First of all, the <code>GraphicsCanvas</code> ain’t “just a <code>QtObject</code>”. At all. It’s too intertwined with commands, threads, events, <code>Shell</code>s, <code>Workspace</code>s, etc. for me to figure out. I just don’t get it. Couldn’t they just wrap a <code>QOpenGLWidget</code> or a <code>QSurface</code> and be done with it? Apparently not…</p>
<p>While they DID do both of the above, they also did sooooooo much more beyond that that my reversing skills started laughing hysterically - and not the good kind of laugh, the “oh boy what the actual fuck is this” kind of laugh.</p>
<p>Even so, I thought to start throwing shit to the wall till something sticks. I see the canvas gone, or glitched, or (praying) in a separate window and I whipped out frida.</p>
<p>But frida seems to be as confused as me when dealing with C++ MSVC ABI when dealing with object instances on Windows. I just tried calling <code>QWindow(nullptr)::QWindow</code> from the <code>Qt5Gui.dll</code> and after that call <code>show()::QWindow</code>. Frida wouldn’t have me do my shit. Frida was done with me.</p>
<h1 id="and-now">And now?</h1>
<p>This is the point where I give up. This might seem a small post but it took me a great 6 months to learn what I did. Did you know there’s a “Command Panel” in Fusion? Did you know that there’s a <a href="https://github.com/kantoku-code/Fusion360_Small_Tools_for_Developers">github repo</a> just describing the commands in it? Did you know that you can dump the Qt tree of Fusion while its running?</p>
<p>Useful Fusion commands (Opened by File > View > Show Text Commands (Ctrl-Alt-C), all commands are Txt):</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#E1E4E8">TextCommands.List </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">hidden </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> Show </span><span style="color:#79B8FF">all</span><span style="color:#E1E4E8"> text commands</span></span>
<span class="line"><span style="color:#E1E4E8">Options.DebugEnvironment </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">show </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> Show a debug environment, didn</span><span style="color:#9ECBFF">'t see something interesting</span></span>
<span class="line"><span style="color:#E1E4E8">Options.showAllCommands </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">on </span><span style="color:#F97583">-</span><span style="color:#FDAEB7;font-style:italic"> ???</span></span>
<span class="line"><span style="color:#E1E4E8">Options.showAllOptions </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> Make </span><span style="color:#79B8FF">MANY</span><span style="color:#E1E4E8"> preferences visible</span></span>
<span class="line"><span style="color:#E1E4E8">Toolkit.DumpQt </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> Dump </span><span style="color:#79B8FF">QT</span><span style="color:#79B8FF"> object</span><span style="color:#E1E4E8"> info. [</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">styles] [</span><span style="color:#F97583">/class</span><span style="color:#E1E4E8">] [</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">rect]</span></span></code></pre>
<p>Also got to learn about C++ RTTI and vftables and that nothing can be compared to the hatred that I have for that FUCKING LANGUAGE THAT HELL GIFTED TO US.</p>
<p>REALLY. WHAT THE FUCK IS WRONG WITH YOU PEOPLE.</p>
<p>If someone is able to make a PoC that shows that indeed a Canvas can be drawn on its own (with some boilerplate), I’ll be more than happy to open this can of worms.</p>
<p>Also I re-implemented Fusion’s installer in python that also knows about Fusion’s build versions, <a href="https://github.com/dzervas/fusion360-streamer">check it out</a>.</p>
<p>C ya</p>  </div> <footer class="post-footer" data-astro-cid-gjtny2mx> <div class="footer-sep" aria-hidden="true" data-astro-cid-gjtny2mx></div> <div class="author-card" data-astro-cid-gjtny2mx> <img src="https://www.gravatar.com/avatar/c9ccfe62d2de0aebdb79a1e7cf5c7019?s=100&d=identicon" alt="dzervas" class="author-avatar" width="64" height="64" data-astro-cid-gjtny2mx> <div class="author-info" data-astro-cid-gjtny2mx> <p class="author-label" data-astro-cid-gjtny2mx>// written_by</p> <p class="author-name" data-astro-cid-gjtny2mx>dzervas</p> <p class="author-bio" data-astro-cid-gjtny2mx>Creator of this site and lover of fails.</p> </div> </div> </footer> </article>  </main> <footer class="site-footer" data-astro-cid-sz7xmlte> <div class="footer-separator" aria-hidden="true" data-astro-cid-sz7xmlte></div> <div class="footer-inner" data-astro-cid-sz7xmlte> <div class="footer-main" data-astro-cid-sz7xmlte> <nav class="footer-social" aria-label="Social links" data-astro-cid-sz7xmlte> <ul class="social-list" data-astro-cid-sz7xmlte> <li data-astro-cid-sz7xmlte> <a href="https://kafeneio.social/@dzervas" class="social-link" target="_blank" rel="noopener noreferrer" data-astro-cid-sz7xmlte> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-mastodon "><path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.432 4.014.535c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.41 2.405 1.228l.518.869.519-.869c.533-.818 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558z"/></svg> <span class="social-label" data-astro-cid-sz7xmlte>Mastodon</span> </a> </li><li data-astro-cid-sz7xmlte> <a href="https://github.com/dzervas/whynot.fail" class="social-link" target="_blank" rel="noopener noreferrer" data-astro-cid-sz7xmlte> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github "><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg> <span class="social-label" data-astro-cid-sz7xmlte>GitHub</span> </a> </li><li data-astro-cid-sz7xmlte> <a href="/rss.xml" class="social-link" data-astro-cid-sz7xmlte> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-rss "><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg> <span class="social-label" data-astro-cid-sz7xmlte>RSS Feed</span> </a> </li> </ul> </nav> </div> </div> </footer>  <nav class="webring" aria-label="Webring"> <a class="webring-link edge-link webring-link--prev" href="https://webring.stavros.io/prev"> <span class="webring-arrow" aria-hidden="true">&lt;</span> <span class="webring-label">Previous blog</span> </a> <a class="webring-link edge-link webring-link--next" href="https://webring.stavros.io/next"> <span class="webring-arrow" aria-hidden="true">&gt;</span> <span class="webring-label">Next blog</span> </a> </nav> <a class="back-to-top edge-link" href="#top" data-back-to-top> <span class="webring-arrow back-to-top-arrow" aria-hidden="true">^</span> <span class="webring-label back-to-top-label">Top</span> </a> </div> <div class="search-overlay" data-search-overlay hidden> <div class="search-backdrop" data-search-close></div> <div class="search-panel" role="dialog" aria-modal="true" aria-label="Search"> <header class="search-header"> <input type="search" class="search-input" placeholder="Search posts..." aria-label="Search posts" data-search-input> <button class="search-close" type="button" aria-label="Close search" data-search-close>
&times;
</button> </header> <div class="search-results" data-search-results> <p class="search-empty">Type something and hit Enter. Or just panic.</p> </div> </div> </div>  <script type="module">const e=document.querySelector("[data-back-to-top]"),t=document.querySelector(".site-footer"),r=()=>{e instanceof HTMLElement&&e.toggleAttribute("data-visible",window.scrollY>240)},o=()=>{if(!(e instanceof HTMLElement)||!(t instanceof HTMLElement))return;const n=t.getBoundingClientRect().height;e.style.setProperty("--footer-height",`${n}px`)};r();o();window.addEventListener("scroll",r,{passive:!0});window.addEventListener("resize",o,{passive:!0});window.addEventListener("load",o,{passive:!0});t&&new ResizeObserver(o).observe(t);</script> <script type="module">const y={cdnUrl:"https://cdn.jsdelivr.net/npm/lunr/lunr.min.js"},c=document.querySelector("[data-search-overlay]"),r=document.querySelector("[data-search-results]"),i=document.querySelector("[data-search-input]"),w=document.querySelectorAll("[data-search-close]"),g=document.querySelector("[data-search-trigger]");c&&(c.hidden=!0);let l=null,u=[],o=null,s=-1;const L=()=>new Promise((e,t)=>{if(window.lunr){e(window.lunr);return}const n=document.createElement("script");n.src=y.cdnUrl,n.async=!0,n.onload=()=>{window.lunr?e(window.lunr):t(new Error("Lunr CDN loaded without window.lunr"))},n.onerror=()=>t(new Error("Failed to load Lunr CDN")),document.head.appendChild(n)}),E=async()=>o||(o=await L(),o),k=e=>e.length===0?'<p class="search-empty">No matches. Try a different incantation.</p>':(e.length>10?e.slice(0,10):e).map((n,a)=>{const d=n.tags.slice(0,3).map(m=>`<span class="search-tag">${m}</span>`).join("");return`
        <a class="search-item${a===s?" is-active":""}" data-search-item href="${n.slug}">
          <span class="search-title">${n.title}</span>
          <span class="search-description">${n.description}</span>
          <span class="search-tags">${d}</span>
        </a>
      `}).join(""),p=()=>{!c||!i||(c.hidden=!1,document.body.classList.add("search-open"),i.value="",s=-1,r&&(r.innerHTML='<p class="search-empty">Type something and hit Enter. Or just panic.</p>'),window.setTimeout(()=>i.focus(),0))},h=()=>{c&&(c.hidden=!0,document.body.classList.remove("search-open"))},v=async()=>{if(l)return;u=await(await fetch("/search.json")).json(),l=(await E())(function(){this.ref("slug"),this.field("title"),this.field("description"),this.field("tags"),this.field("category"),u.forEach(n=>this.add(n))})},A=async e=>{if(!r)return[];if(await v(),!l)return[];const n=l.search(e).slice(0,25).map(a=>u.find(d=>d.slug===a.ref)).filter(a=>!!a);return r.innerHTML=k(n),n},f=e=>{if(!r)return;const t=Array.from(r.querySelectorAll("[data-search-item]"));t.length!==0&&(s=(s+e+t.length)%t.length,t.forEach((n,a)=>{n.classList.toggle("is-active",a===s)}),t[s].scrollIntoView({block:"nearest"}))},C=()=>{if(!r)return;const e=Array.from(r.querySelectorAll("[data-search-item]"));e.length===0||s<0||e[s].click()},S=e=>{if((e.metaKey||e.ctrlKey)&&e.key.toLowerCase()==="k"){e.preventDefault(),p();return}if(e.key==="Escape"){h();return}!c||c.hidden||((e.key==="ArrowDown"||e.key.toLowerCase()==="j")&&(e.preventDefault(),f(1)),(e.key==="ArrowUp"||e.key.toLowerCase()==="k")&&(e.preventDefault(),f(-1)),e.key==="Enter"&&(e.preventDefault(),C()))};i&&i.addEventListener("input",e=>{const t=e.target.value.trim();if(t.length===0){s=-1,r&&(r.innerHTML='<p class="search-empty">Type something and hit Enter. Or just panic.</p>');return}A(t).then(()=>{s=-1,r&&r.querySelectorAll("[data-search-item]").forEach(a=>a.classList.remove("is-active"))})});w.forEach(e=>e.addEventListener("click",h));g?.addEventListener("click",p);document.addEventListener("keydown",S);document.addEventListener("click",e=>{const t=e.target;(t.matches("[data-search-close]")||t.closest("[data-search-close]"))&&h()});const j=document.documentElement;j.classList.add("js-enabled");</script> </body> </html>  