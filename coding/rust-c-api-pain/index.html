<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="Cause when you fail, somebody has to laugh at you"><title>Rust, let me share your awesomeness with C | WhyNot.Fail</title><!-- Fonts --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Raleway:wght@400;500;600;700&display=swap" rel="stylesheet"><!-- Favicon --><link rel="icon" type="image/svg+xml" href="/favicon.svg"><!-- RSS --><link rel="alternate" type="application/rss+xml" title="WhyNot.Fail RSS" href="/rss.xml"><style>.tag-list[data-astro-cid-lga65v7i]{display:flex;flex-wrap:wrap;gap:.5rem;list-style:none;padding:0;margin:0}.tag[data-astro-cid-lga65v7i]{display:inline-block;padding:.25rem .625rem;font-size:.8125rem;font-weight:500;text-decoration:none;color:var(--color-accent);background:var(--color-accent-bg);border:1px solid var(--color-accent-border);border-radius:4px;transition:all .15s ease}.tag[data-astro-cid-lga65v7i]:hover{background:var(--color-accent);color:var(--color-bg);border-color:var(--color-accent)}.build-badge[data-astro-cid-mzimu5gx]{display:inline-flex;align-items:center;font-family:JetBrains Mono,monospace;font-size:.8125rem;letter-spacing:.02em}.badge-prefix[data-astro-cid-mzimu5gx]{color:var(--color-text-muted)}.badge-status[data-astro-cid-mzimu5gx]{font-weight:600}.badge-passing[data-astro-cid-mzimu5gx] .badge-status[data-astro-cid-mzimu5gx]{color:var(--color-success)}.badge-failing[data-astro-cid-mzimu5gx] .badge-status[data-astro-cid-mzimu5gx]{color:var(--color-danger)}.badge-unknown[data-astro-cid-mzimu5gx] .badge-status[data-astro-cid-mzimu5gx]{color:var(--color-warning)}
</style>
<link rel="stylesheet" href="/_astro/_slug_.BSLznIs-.css">
<link rel="stylesheet" href="/_astro/_slug_.ClLXJwUM.css"></head> <body id="top"> <div class="site-wrapper"> <header class="site-header" data-astro-cid-3ef6ksr2> <div class="header-inner" data-astro-cid-3ef6ksr2> <a href="/" class="logo" aria-label="WhyNot.Fail" data-astro-cid-3ef6ksr2> <pre class="ascii-logo" aria-hidden="true" data-astro-cid-3ef6ksr2>
 █   █ █ █ █ █ █▄ █ █▀█ ▀█▀
 █▄█▄█ █▀█ ▀█▀ █ ▀█ █▄█  █
        ·FAIL·
      </pre> <span class="logo-tagline" data-astro-cid-3ef6ksr2>// cause_when_you_fail_somebody_has_to_laugh_at_you</span> </a> <div class="header-actions" data-astro-cid-3ef6ksr2> <nav class="nav-main" aria-label="Main navigation" data-astro-cid-3ef6ksr2> <ul class="nav-list" data-astro-cid-3ef6ksr2> <li data-astro-cid-3ef6ksr2> <a href="/" class="nav-link" data-astro-cid-3ef6ksr2> Home </a> </li><li data-astro-cid-3ef6ksr2> <a href="/about/" class="nav-link" data-astro-cid-3ef6ksr2> About </a> </li><li data-astro-cid-3ef6ksr2> <a href="/tags/" class="nav-link" data-astro-cid-3ef6ksr2> Tags </a> </li> </ul> </nav> <div class="search-shell" data-search-trigger data-astro-cid-3ef6ksr2> <input type="search" class="search-trigger" placeholder="Search" aria-label="Open search" readonly data-astro-cid-3ef6ksr2> <span class="search-shortcut" data-astro-cid-3ef6ksr2>Ctrl+K</span> </div> </div> </div> <div class="header-separator" aria-hidden="true" data-astro-cid-3ef6ksr2></div> </header>  <main class="main-content">  <article class="post" data-astro-cid-gjtny2mx> <header class="post-header" data-astro-cid-gjtny2mx> <div class="post-header-top" data-astro-cid-gjtny2mx> <a href="/" class="back-link" data-astro-cid-gjtny2mx> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-arrow-left "><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg> <span data-astro-cid-gjtny2mx>Back to posts</span> </a>  </div> <div class="post-meta" data-astro-cid-gjtny2mx> <time datetime="2019-12-04T00:00:00.000Z" data-astro-cid-gjtny2mx>04 December 2019</time> <span class="meta-sep" data-astro-cid-gjtny2mx>/</span> <span class="post-author" data-astro-cid-gjtny2mx>dzervas</span>  <span class="meta-sep" data-astro-cid-gjtny2mx>/</span> <span class="build-badge badge-failing" data-astro-cid-mzimu5gx> <span class="badge-prefix" data-astro-cid-mzimu5gx>build:</span> <span class="badge-status" data-astro-cid-mzimu5gx>[FAIL]</span> </span>   </div> <h1 class="post-title" data-astro-cid-gjtny2mx>Rust, let me share your awesomeness with C</h1> <div class="post-tags" data-astro-cid-gjtny2mx> <ul class="tag-list" data-astro-cid-lga65v7i><li data-astro-cid-lga65v7i><a href="/tags/coding/" class="tag" data-astro-cid-lga65v7i>coding</a></li><li data-astro-cid-lga65v7i><a href="/tags/rust/" class="tag" data-astro-cid-lga65v7i>rust</a></li><li data-astro-cid-lga65v7i><a href="/tags/programming/" class="tag" data-astro-cid-lga65v7i>programming</a></li></ul> </div> </header> <div class="post-hero" data-astro-cid-gjtny2mx> <img src="/images/notion-6d2ace92-b62a-4879-b306-6cbe6ae6d0e1-image.jpg" alt="Rust, let me share your awesomeness with C" loading="lazy" data-astro-cid-gjtny2mx> </div> <div class="post-content" data-astro-cid-gjtny2mx>  <p>Ahoy reader, this is kinda an open letter. But mostly is my desperation in computer font. Rust why don’t you love me? I read about you, I spent nights and days. I fought the borrow checker monster for you. I learned about lifetimes. And you promised two things: - “Systems” language, close to C - Memory safety</p>
<p>I just wanna call you via a C binary. I don’t want you to fly. I just wanna love you…</p>
<p>But before we get to the chase, lets get to drama. You know how I love backstories (and I’ve been watching How to get away with murder).</p>
<h2 id="the-story">The story</h2>
<p>The project that all this happend for is not a new idea to me. It boiled inside me for quite some time. I’m referring to mage I started writing it about 6 months ago, when a friend asked me for a stable tool that is able to listen for TCP shells and have TTY support for his OSCP (that’s a story for another day, for more check out <a href="https://github.com/dzervas/netcatty">netcatty</a>). Of course I stopped whatever (another project) I was doing and started coding. I was currently into Go, so I went with it. As I was writing netcatty, first of all I lost a huge oportunity to name it netkitty which is way better and second I started spiraling out about what I could actually do. Why only TCP? I can do better!</p>
<p>That’s where mage was born. Mage is a tiny protocol, intended to be encapsulated inside all kinds of transports. HTTP requests, headers, cookies, TCP timestamps, DNS queries etc. What a marvelous idea!</p>
<p>Remember when post-exploitation toolkits &#x26; implants communicated with the C2 over TCP or HTTP? Remember when you could feel the earth shaking every time a meterpreter payload exited the final gateway of a target cause a stray UDP connection to a russian server on port 1337 just opened? Remember when the connection would get killed and your server banned after 5’ you got a shell? Well mage is willing to do its magic to stop this madness.</p>
<p><img src="/images/notion-d0b35ea8-7e06-4ca0-87d8-e9accc2926ef-blue-team-laughing.jpg" alt="The blue team laughing at your windows/meterpreter/reverse_tcp"></p>
<p>The idea is that you generate a binary payload (msf or whatever) and you “wrap” it using mage. By wrap I mean that the mage .so (or .dll) would be injected inside the binary and then binary patch all the <code>socket.h</code> (or <code>winsock</code>) calls to use the mage functions (spoiler: “wrapping” is not yet implemented, that’s what this post is about).</p>
<p>The mage primarilly does the following: - Connect to the C2 (completely ignoring the address that the implant wanted to connect to) over whatever protocol you set up during wrapping - Exchange keys with the server (libsodium) - Start encrypted communication with the server (libsodium)</p>
<p>Useful features include chunking, very low overhead, support for out-of-order packet reception (and maybe sometime packet retransmission?)</p>
<p>That’s all good, but I’m still talking about a Go project huh? No…</p>
<p>As any good project, you have to write it at least twice for it to be good. I think I maybe overdid it and rewrote it too fast. <a href="https://github.com/dzervas/mage">Here</a>. I rewrote it in rust. Rust was a much better fit, as it’s much closer to the system, it doesn’t carry a GC and the overal Rust - <code>insert-lang-here</code> interfacing I THOUGHT was easier. If I only knew…</p>
<h2 id="the-target">The target</h2>
<p>As said, wrapping is not ready. Nor any actually useful transports. Right now the protocol, encryption/decryption, multiplexing and thread channels are ready. To start implementing wrapping, I had to create a libC API. All answers led to <code>cbindgen</code>, a very cool project that all it does is generate C headers, but to use it, you need to create a C API!</p>
<p>The “final” struct that I wanted to export was <code>Connection</code> (see <a href="https://github.com/dzervas/mage/blob/master/src/connection.rs">here</a>):</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#F97583">pub</span><span style="color:#F97583"> struct</span><span style="color:#B392F0"> Connection</span><span style="color:#E1E4E8">&#x3C;'</span><span style="color:#B392F0">conn</span><span style="color:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#F97583">    pub</span><span style="color:#E1E4E8"> id</span><span style="color:#F97583">:</span><span style="color:#B392F0"> u32</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    stream</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Stream</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    reader</span><span style="color:#F97583">:</span><span style="color:#F97583"> &#x26;</span><span style="color:#E1E4E8">'</span><span style="color:#B392F0">conn</span><span style="color:#F97583"> mut</span><span style="color:#F97583"> dyn</span><span style="color:#B392F0"> Read</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    writer</span><span style="color:#F97583">:</span><span style="color:#F97583"> &#x26;</span><span style="color:#E1E4E8">'</span><span style="color:#B392F0">conn</span><span style="color:#F97583"> mut</span><span style="color:#F97583"> dyn</span><span style="color:#B392F0"> Write</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    channels</span><span style="color:#F97583">:</span><span style="color:#B392F0"> HashMap</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">u8</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">Vec</span><span style="color:#E1E4E8">&#x3C;(</span><span style="color:#B392F0">Sender</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Vec</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">u8</span><span style="color:#E1E4E8">>>, </span><span style="color:#B392F0">Receiver</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Vec</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">u8</span><span style="color:#E1E4E8">>>)>></span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"><span style="color:#F97583">impl</span><span style="color:#E1E4E8">&#x3C;'</span><span style="color:#B392F0">conn</span><span style="color:#E1E4E8">> </span><span style="color:#B392F0">Connection</span><span style="color:#E1E4E8">&#x3C;'</span><span style="color:#B392F0">conn</span><span style="color:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#F97583">pub</span><span style="color:#F97583"> fn</span><span style="color:#B392F0"> new</span><span style="color:#E1E4E8">(id</span><span style="color:#F97583">:</span><span style="color:#B392F0"> u32</span><span style="color:#E1E4E8">, reader</span><span style="color:#F97583">:</span><span style="color:#F97583"> &#x26;</span><span style="color:#E1E4E8">'</span><span style="color:#B392F0">conn</span><span style="color:#F97583"> mut</span><span style="color:#F97583"> impl</span><span style="color:#B392F0"> Read</span><span style="color:#E1E4E8">, writer</span><span style="color:#F97583">:</span><span style="color:#F97583"> &#x26;</span><span style="color:#E1E4E8">'</span><span style="color:#B392F0">conn</span><span style="color:#F97583"> mut</span><span style="color:#F97583"> impl</span><span style="color:#B392F0"> Write</span><span style="color:#E1E4E8">, server</span><span style="color:#F97583">:</span><span style="color:#B392F0"> bool</span><span style="color:#E1E4E8">, seed</span><span style="color:#F97583">:</span><span style="color:#F97583"> &#x26;</span><span style="color:#E1E4E8">[</span><span style="color:#B392F0">u8</span><span style="color:#E1E4E8">], remote_key</span><span style="color:#F97583">:</span><span style="color:#F97583"> &#x26;</span><span style="color:#E1E4E8">[</span><span style="color:#B392F0">u8</span><span style="color:#E1E4E8">]) </span><span style="color:#F97583">-></span><span style="color:#B392F0"> Result</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#79B8FF">Self</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">...</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"><span style="color:#F97583">impl</span><span style="color:#B392F0"> Read</span><span style="color:#F97583"> for</span><span style="color:#B392F0"> Connection</span><span style="color:#E1E4E8">&#x3C;'</span><span style="color:#B392F0">_</span><span style="color:#E1E4E8">> {</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">}</span></span>
<span class="line"><span style="color:#F97583">impl</span><span style="color:#B392F0"> Write</span><span style="color:#F97583"> for</span><span style="color:#B392F0"> Connection</span><span style="color:#E1E4E8">&#x3C;'</span><span style="color:#B392F0">_</span><span style="color:#E1E4E8">> {</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">}</span></span></code></pre>
<p>The C API has to be like that (to be in-place compatible with <code>socket.h</code>):</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#E1E4E8">#[no_mangle]</span></span>
<span class="line"><span style="color:#F97583">pub</span><span style="color:#F97583"> unsafe</span><span style="color:#F97583"> extern</span><span style="color:#9ECBFF"> "C"</span><span style="color:#F97583"> fn</span><span style="color:#B392F0"> connect</span><span style="color:#E1E4E8">(_socket</span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> c_int, _sockaddr</span><span style="color:#F97583">:</span><span style="color:#F97583"> *const</span><span style="color:#E1E4E8"> c_void, _address_len</span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> c_void) </span><span style="color:#F97583">-></span><span style="color:#E1E4E8"> c_int</span></span>
<span class="line"><span style="color:#E1E4E8">#[no_mangle]</span></span>
<span class="line"><span style="color:#F97583">pub</span><span style="color:#F97583"> unsafe</span><span style="color:#F97583"> extern</span><span style="color:#9ECBFF"> "C"</span><span style="color:#F97583"> fn</span><span style="color:#B392F0"> send</span><span style="color:#E1E4E8">(_socket</span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> c_int, msg</span><span style="color:#F97583">:</span><span style="color:#F97583"> *const</span><span style="color:#E1E4E8"> c_void, size</span><span style="color:#F97583">:</span><span style="color:#B392F0"> usize</span><span style="color:#E1E4E8">, _flags</span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> c_int) </span><span style="color:#F97583">-></span><span style="color:#B392F0"> usize</span></span>
<span class="line"><span style="color:#E1E4E8">#[no_mangle]</span></span>
<span class="line"><span style="color:#F97583">pub</span><span style="color:#F97583"> unsafe</span><span style="color:#F97583"> extern</span><span style="color:#9ECBFF"> "C"</span><span style="color:#F97583"> fn</span><span style="color:#B392F0"> recv</span><span style="color:#E1E4E8">(_socket</span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> c_int, msg</span><span style="color:#F97583">:</span><span style="color:#F97583"> *mut</span><span style="color:#E1E4E8"> c_void, size</span><span style="color:#F97583">:</span><span style="color:#B392F0"> usize</span><span style="color:#E1E4E8">, _flags</span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> c_int) </span><span style="color:#F97583">-></span><span style="color:#B392F0"> usize</span></span></code></pre>
<p>It does not implement all the <code>socket.h</code> functions, but I started with the most vital ones.</p>
<p>This is my target, expose <code>connect</code>, <code>send</code> and <code>recv</code> to C and let them handle the whole logic. No mystery threads n’ stuff, it could mess a lot wit AV evasion (while it AV evasion has nothing to do with this project, I shouldn’t make it harder)</p>
<h2 id="the-problem">The problem</h2>
<p>The problem that I quickly realized was that there was no way to have a “state”. I couldn’t just pass the <code>Connection</code> struct back &#x26; forth, as <code>socket.h</code> does! I have to adhere to the function signatures and if someone messes with my struct in a completely unchecked manner, anything could go wrong.</p>
<p>So I went on and tried to create a static object holding a <code>Connection</code>, that would be initialized on <code>connect</code>. Oh the horror…</p>
<p>Rust says that it needs to know the size of <code>Connection</code> at compile time to let me have it as static. That’s not possible. I add a reference, but it can’t live long enough so I go with <code>Box</code>. <code>lazy_static</code> enters the game. No idea what it does, but it solved a problem with static. But introduces another. No mutability. So I add a <code>Mutex</code>.</p>
<p>Right now we have this:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="rust"><code><span class="line"><span style="color:#B392F0">lazy_static!</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">	static</span><span style="color:#F97583"> ref</span><span style="color:#79B8FF"> CONN</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Mutex</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Option</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Box</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Connection</span><span style="color:#E1E4E8">>>> </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Mutex</span><span style="color:#F97583">::</span><span style="color:#B392F0">new</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">None</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Ok, that’s fine. It compiles (nobody knows if this actually works yet). But then starts another rabbit hole. Inside <code>connect</code>, among other stuff I call <code>Connection::new</code>. <code>Connection::new</code> accepts <code>reader: &#x26;'conn mut impl Read, writer: &#x26;'conn mut impl Write</code>. And these are satisified by a <code>TcpStream</code> and <code>TcpStream.try_clone.unwrap()</code>. Now I can’t borrow these, as they’re inside the function scope.</p>
<p>This is the problem. I don’t know how to pass <code>TcpStream</code> to a new static <code>Connection</code>. I tried making it static as well, <code>Box</code>ing and <code>Rc</code>ing them. Didn’t fucking work. If anyone can help, please do so…</p>
<p><img src="/images/notion-b2b5a373-c5d0-48ff-a3e2-da9b4bcf101b-code-after-trial-and-error.jpg" alt="My code after all the &#x22;tries”"></p>
<hr>
<p>I know that you don’t read this type of posts often - or I don’t often read them (ranting due to lack of skill). But this was mainly a rubber duck debugging session for me and it’s one of the very few moments that I’m so stuck, that I’m thinking about abandoning the project. Most times I just get bored or find something new. This is different. I’ve hit a brick wall and can’t find even a really dirty hack around it (even though I hate “hacky” code).</p>
<p>Happy Hacking!</p>  </div> <footer class="post-footer" data-astro-cid-gjtny2mx> <div class="footer-sep" aria-hidden="true" data-astro-cid-gjtny2mx></div> <div class="author-card" data-astro-cid-gjtny2mx> <img src="https://www.gravatar.com/avatar/c9ccfe62d2de0aebdb79a1e7cf5c7019?s=100&d=identicon" alt="dzervas" class="author-avatar" width="64" height="64" data-astro-cid-gjtny2mx> <div class="author-info" data-astro-cid-gjtny2mx> <p class="author-label" data-astro-cid-gjtny2mx>// written_by</p> <p class="author-name" data-astro-cid-gjtny2mx>dzervas</p> <p class="author-bio" data-astro-cid-gjtny2mx>Creator of this site and lover of fails.</p> </div> </div> </footer> </article>  </main> <footer class="site-footer" data-astro-cid-sz7xmlte> <div class="footer-separator" aria-hidden="true" data-astro-cid-sz7xmlte></div> <div class="footer-inner" data-astro-cid-sz7xmlte> <div class="footer-main" data-astro-cid-sz7xmlte> <nav class="footer-social" aria-label="Social links" data-astro-cid-sz7xmlte> <ul class="social-list" data-astro-cid-sz7xmlte> <li data-astro-cid-sz7xmlte> <a href="https://kafeneio.social/@dzervas" class="social-link" target="_blank" rel="noopener noreferrer" data-astro-cid-sz7xmlte> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-mastodon "><path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.432 4.014.535c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.41 2.405 1.228l.518.869.519-.869c.533-.818 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558z"/></svg> <span class="social-label" data-astro-cid-sz7xmlte>Mastodon</span> </a> </li><li data-astro-cid-sz7xmlte> <a href="https://github.com/dzervas/whynot.fail" class="social-link" target="_blank" rel="noopener noreferrer" data-astro-cid-sz7xmlte> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github "><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg> <span class="social-label" data-astro-cid-sz7xmlte>GitHub</span> </a> </li><li data-astro-cid-sz7xmlte> <a href="/rss.xml" class="social-link" data-astro-cid-sz7xmlte> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-rss "><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg> <span class="social-label" data-astro-cid-sz7xmlte>RSS Feed</span> </a> </li> </ul> </nav> </div> </div> </footer>  <nav class="webring" aria-label="Webring"> <a class="webring-link edge-link webring-link--prev" href="https://webring.stavros.io/prev"> <span class="webring-arrow" aria-hidden="true">&lt;</span> <span class="webring-label">Previous blog</span> </a> <a class="webring-link edge-link webring-link--next" href="https://webring.stavros.io/next"> <span class="webring-arrow" aria-hidden="true">&gt;</span> <span class="webring-label">Next blog</span> </a> </nav> <a class="back-to-top edge-link" href="#top" data-back-to-top> <span class="webring-arrow back-to-top-arrow" aria-hidden="true">^</span> <span class="webring-label back-to-top-label">Top</span> </a> </div> <div class="search-overlay" data-search-overlay hidden> <div class="search-backdrop" data-search-close></div> <div class="search-panel" role="dialog" aria-modal="true" aria-label="Search"> <header class="search-header"> <input type="search" class="search-input" placeholder="Search posts..." aria-label="Search posts" data-search-input> <button class="search-close" type="button" aria-label="Close search" data-search-close>
&times;
</button> </header> <div class="search-results" data-search-results> <p class="search-empty">Type something and hit Enter. Or just panic.</p> </div> </div> </div>  <script type="module">const e=document.querySelector("[data-back-to-top]"),t=document.querySelector(".site-footer"),r=()=>{e instanceof HTMLElement&&e.toggleAttribute("data-visible",window.scrollY>240)},o=()=>{if(!(e instanceof HTMLElement)||!(t instanceof HTMLElement))return;const n=t.getBoundingClientRect().height;e.style.setProperty("--footer-height",`${n}px`)};r();o();window.addEventListener("scroll",r,{passive:!0});window.addEventListener("resize",o,{passive:!0});window.addEventListener("load",o,{passive:!0});t&&new ResizeObserver(o).observe(t);</script> <script type="module">const y={cdnUrl:"https://cdn.jsdelivr.net/npm/lunr/lunr.min.js"},c=document.querySelector("[data-search-overlay]"),r=document.querySelector("[data-search-results]"),i=document.querySelector("[data-search-input]"),w=document.querySelectorAll("[data-search-close]"),g=document.querySelector("[data-search-trigger]");c&&(c.hidden=!0);let l=null,u=[],o=null,s=-1;const L=()=>new Promise((e,t)=>{if(window.lunr){e(window.lunr);return}const n=document.createElement("script");n.src=y.cdnUrl,n.async=!0,n.onload=()=>{window.lunr?e(window.lunr):t(new Error("Lunr CDN loaded without window.lunr"))},n.onerror=()=>t(new Error("Failed to load Lunr CDN")),document.head.appendChild(n)}),E=async()=>o||(o=await L(),o),k=e=>e.length===0?'<p class="search-empty">No matches. Try a different incantation.</p>':(e.length>10?e.slice(0,10):e).map((n,a)=>{const d=n.tags.slice(0,3).map(m=>`<span class="search-tag">${m}</span>`).join("");return`
        <a class="search-item${a===s?" is-active":""}" data-search-item href="${n.slug}">
          <span class="search-title">${n.title}</span>
          <span class="search-description">${n.description}</span>
          <span class="search-tags">${d}</span>
        </a>
      `}).join(""),p=()=>{!c||!i||(c.hidden=!1,document.body.classList.add("search-open"),i.value="",s=-1,r&&(r.innerHTML='<p class="search-empty">Type something and hit Enter. Or just panic.</p>'),window.setTimeout(()=>i.focus(),0))},h=()=>{c&&(c.hidden=!0,document.body.classList.remove("search-open"))},v=async()=>{if(l)return;u=await(await fetch("/search.json")).json(),l=(await E())(function(){this.ref("slug"),this.field("title"),this.field("description"),this.field("tags"),this.field("category"),u.forEach(n=>this.add(n))})},A=async e=>{if(!r)return[];if(await v(),!l)return[];const n=l.search(e).slice(0,25).map(a=>u.find(d=>d.slug===a.ref)).filter(a=>!!a);return r.innerHTML=k(n),n},f=e=>{if(!r)return;const t=Array.from(r.querySelectorAll("[data-search-item]"));t.length!==0&&(s=(s+e+t.length)%t.length,t.forEach((n,a)=>{n.classList.toggle("is-active",a===s)}),t[s].scrollIntoView({block:"nearest"}))},C=()=>{if(!r)return;const e=Array.from(r.querySelectorAll("[data-search-item]"));e.length===0||s<0||e[s].click()},S=e=>{if((e.metaKey||e.ctrlKey)&&e.key.toLowerCase()==="k"){e.preventDefault(),p();return}if(e.key==="Escape"){h();return}!c||c.hidden||((e.key==="ArrowDown"||e.key.toLowerCase()==="j")&&(e.preventDefault(),f(1)),(e.key==="ArrowUp"||e.key.toLowerCase()==="k")&&(e.preventDefault(),f(-1)),e.key==="Enter"&&(e.preventDefault(),C()))};i&&i.addEventListener("input",e=>{const t=e.target.value.trim();if(t.length===0){s=-1,r&&(r.innerHTML='<p class="search-empty">Type something and hit Enter. Or just panic.</p>');return}A(t).then(()=>{s=-1,r&&r.querySelectorAll("[data-search-item]").forEach(a=>a.classList.remove("is-active"))})});w.forEach(e=>e.addEventListener("click",h));g?.addEventListener("click",p);document.addEventListener("keydown",S);document.addEventListener("click",e=>{const t=e.target;(t.matches("[data-search-close]")||t.closest("[data-search-close]"))&&h()});const j=document.documentElement;j.classList.add("js-enabled");</script> </body> </html>  