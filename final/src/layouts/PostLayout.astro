---
/**
 * Layout for individual blog posts
 */
import type { CollectionEntry } from "astro:content";
import BaseLayout from "./BaseLayout.astro";
import TagList from "../components/TagList.astro";
import BuildBadge from "../components/BuildBadge.astro";
import Icon from "../components/Icon.astro";

interface Props {
	post: CollectionEntry<"posts">;
}

const { post } = Astro.props;
const { title, date, tags, build_status, writer, description } = post.data;

const formattedDate = date.toLocaleDateString("en-GB", {
	day: "2-digit",
	month: "long",
	year: "numeric",
});
---

<BaseLayout title={title} description={description}>
	<article class="post">
		<header class="post-header">
			<a href="/" class="back-link">
				<Icon name="arrow-left" size={16} />
				<span>Back to posts</span>
			</a>

			<div class="post-meta">
				<time datetime={date.toISOString()}>{formattedDate}</time>
				<span class="meta-sep">/</span>
				<span class="post-author">{writer}</span>
				{
					build_status && (
						<>
							<span class="meta-sep">/</span>
							<BuildBadge status={build_status} />
						</>
					)
				}
			</div>

			<h1 class="post-title">{title}</h1>

			{
				tags.length > 0 && (
					<div class="post-tags">
						<TagList tags={tags} />
					</div>
				)
			}
		</header>

		<div class="post-content">
			<slot />
		</div>

		<footer class="post-footer">
			<div class="footer-sep" aria-hidden="true"></div>

			<div class="author-card">
				<img
					src={`https://www.gravatar.com/avatar/c9ccfe62d2de0aebdb79a1e7cf5c7019?s=100&d=identicon`}
					alt={writer}
					class="author-avatar"
					width="64"
					height="64"
				/>
				<div class="author-info">
					<p class="author-label">// written_by</p>
					<p class="author-name">{writer}</p>
					<p class="author-bio">Creator of this site and lover of fails.</p>
				</div>
			</div>
		</footer>
	</article>
</BaseLayout>

<style>
	.post {
		max-width: 100%;
		margin: 0 auto;
	}

	.back-link {
		display: inline-flex;
		align-items: center;
		gap: 0.375rem;
		font-size: 0.875rem;
		color: var(--color-text-muted);
		text-decoration: none;
		margin-bottom: 1.5rem;
		transition: color 0.15s ease;
	}

	.back-link:hover {
		color: var(--color-accent);
	}

	.post-header {
		margin-bottom: 2.5rem;
	}

	.post-meta {
		display: flex;
		flex-wrap: wrap;
		align-items: center;
		gap: 0.5rem;
		font-size: 0.875rem;
		font-family: "JetBrains Mono", monospace;
		color: var(--color-text-muted);
		margin-bottom: 1rem;
	}

	.meta-sep {
		opacity: 0.5;
	}

	.post-title {
		font-size: clamp(1.75rem, 4vw, 2.25rem);
		font-weight: 700;
		line-height: 1.2;
		margin: 0 0 1rem;
		color: var(--color-text);
	}

	.post-tags {
		margin-top: 1rem;
	}

	/* Post Content Styling */
	.post-content {
		font-size: 1.125rem;
		line-height: 1.7;
		color: var(--color-text-secondary);
	}

	.post-content :global(h2) {
		font-size: 1.5rem;
		font-weight: 600;
		color: var(--color-text);
		margin: 2.5rem 0 1rem;
		padding-top: 1rem;
		border-top: 1px dashed var(--color-border);
	}

	.post-content :global(h2::before) {
		content: "## ";
		color: var(--color-accent);
		opacity: 0.6;
	}

	.post-content :global(h3) {
		font-size: 1.25rem;
		font-weight: 600;
		color: var(--color-text);
		margin: 2rem 0 0.75rem;
	}

	.post-content :global(h3::before) {
		content: "### ";
		color: var(--color-accent);
		opacity: 0.6;
	}

	.post-content :global(p) {
		margin: 1.25rem 0;
	}

	.post-content :global(a) {
		color: var(--color-accent);
		text-decoration: underline;
		text-underline-offset: 2px;
	}

	.post-content :global(a:hover) {
		text-decoration-thickness: 2px;
	}

	.post-content :global(strong) {
		color: var(--color-text);
		font-weight: 600;
	}

	.post-content :global(ul),
	.post-content :global(ol) {
		margin: 1.25rem 0;
		padding-left: 1.5rem;
	}

	.post-content :global(li) {
		margin: 0.5rem 0;
	}

	.post-content :global(blockquote) {
		margin: 1.5rem 0;
		padding: 0.75rem 1.25rem;
		border-left: 3px solid var(--color-accent);
		background: var(--color-surface);
		border-radius: 0 6px 6px 0;
	}

	.post-content :global(blockquote p) {
		margin: 0;
	}

	/* Callouts */
	.post-content :global(.callout) {
		margin: 1.75rem 0;
		padding: 1rem 1.25rem;
		border-left: 4px solid;
		border-radius: 0 8px 8px 0;
		background: var(--color-callout-note-bg);
	}

	.post-content :global(.callout p:first-child) {
		margin-top: 0;
	}

	.post-content :global(.callout-note) {
		border-color: var(--color-callout-note-border);
		color: var(--color-callout-note-text);
	}

	.post-content :global(.callout-info) {
		border-color: var(--color-callout-info-border);
		background: var(--color-callout-info-bg);
		color: var(--color-callout-info-text);
	}

	.post-content :global(.callout-warning) {
		border-color: var(--color-callout-warning-border);
		background: var(--color-callout-warning-bg);
		color: var(--color-callout-warning-text);
	}

	.post-content :global(.callout-danger) {
		border-color: var(--color-callout-danger-border);
		background: var(--color-callout-danger-bg);
		color: var(--color-callout-danger-text);
	}

	/* Code Blocks */
	.post-content :global(pre) {
		margin: 1.5rem 0;
		padding: 1.25rem;
		background: var(--color-code-bg);
		border: 1px solid var(--color-border);
		border-radius: 8px;
		overflow-x: auto;
		font-size: 0.9375rem;
		line-height: 1.6;
	}

	.post-content :global(code) {
		font-family: "JetBrains Mono", monospace;
		font-size: 0.9em;
	}

	.post-content :global(:not(pre) > code) {
		padding: 0.125rem 0.375rem;
		background: var(--color-surface);
		border-radius: 4px;
		color: var(--color-accent);
	}

	/* Tables */
	.post-content :global(table) {
		width: 100%;
		margin: 1.5rem 0;
		border-collapse: collapse;
		font-size: 0.9375rem;
	}

	.post-content :global(th),
	.post-content :global(td) {
		padding: 0.75rem 1rem;
		text-align: left;
		border: 1px solid var(--color-border);
	}

	.post-content :global(th) {
		background: var(--color-surface);
		font-weight: 600;
		color: var(--color-text);
	}

	.post-content :global(tr:nth-child(even)) {
		background: var(--color-surface-alt);
	}

	/* Horizontal Rules */
	.post-content :global(hr) {
		border: none;
		height: 1px;
		background: repeating-linear-gradient(
			90deg,
			var(--color-border) 0,
			var(--color-border) 4px,
			transparent 4px,
			transparent 8px
		);
		margin: 2rem 0;
	}

	/* Callouts - GitHub style parsing */
	.post-content :global(blockquote:has(p:first-child:is([data-callout]))) {
		border-left-color: var(--color-accent);
	}

	/* Post Footer */
	.post-footer {
		margin-top: 3rem;
	}

	.footer-sep {
		height: 1px;
		background: repeating-linear-gradient(
			90deg,
			var(--color-border) 0,
			var(--color-border) 4px,
			transparent 4px,
			transparent 8px
		);
		margin-bottom: 2rem;
	}

	.author-card {
		display: flex;
		gap: 1rem;
		align-items: flex-start;
	}

	.author-avatar {
		width: 64px;
		height: 64px;
		border-radius: 50%;
		border: 2px solid var(--color-border);
	}

	.author-info {
		flex: 1;
	}

	.author-label {
		font-family: "JetBrains Mono", monospace;
		font-size: 0.75rem;
		color: var(--color-text-muted);
		margin: 0 0 0.25rem;
	}

	.author-name {
		font-size: 1.125rem;
		font-weight: 600;
		color: var(--color-text);
		margin: 0 0 0.25rem;
	}

	.author-bio {
		font-size: 0.9375rem;
		color: var(--color-text-secondary);
		margin: 0;
	}
</style>
